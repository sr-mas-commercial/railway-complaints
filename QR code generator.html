<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚂 Railway Asset QR Code Generator - All Categories</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .instructions {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
        }

        .instructions h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .instructions ol {
            margin-left: 20px;
        }

        .instructions li {
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .url-preview {
            background: #e8eaf6;
            padding: 10px 15px;
            border-radius: 6px;
            margin-top: 8px;
            font-family: monospace;
            font-size: 14px;
            color: #5e35b1;
        }

        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f44336;
            color: white;
        }

        .btn-secondary:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #4caf50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2.5em;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
            font-size: 0.9em;
        }

        .category-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .category-card {
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s;
        }

        .category-card:hover {
            border-color: #667eea;
            transform: translateY(-3px);
        }

        .category-card h4 {
            color: #667eea;
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .category-card p {
            color: #666;
            font-size: 0.9em;
        }

        .qr-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .qr-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .qr-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .qr-category-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .qr-disclaimer {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            font-size: 12px;
            color: #856404;
            text-align: left;
            line-height: 1.5;
        }

        .qr-disclaimer strong {
            display: block;
            margin-bottom: 5px;
            font-size: 13px;
        }

        .qr-info {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: left;
        }

        .qr-info-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .qr-info-item:last-child {
            border-bottom: none;
        }

        .qr-info-label {
            font-weight: 600;
            color: #555;
            font-size: 12px;
        }

        .qr-info-value {
            color: #333;
            font-size: 12px;
            text-align: right;
            max-width: 60%;
            word-break: break-word;
        }

        .qr-code-container {
            display: flex;
            justify-content: center;
            margin: 15px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
        }

        .qr-card .asset-details {
            font-size: 13px;
            color: #666;
            margin-bottom: 10px;
            text-align: left;
            line-height: 1.6;
        }

        .qr-card-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #667eea;
        }

        @media print {
            body {
                background: white;
            }
            .container {
                box-shadow: none;
            }
            .header, .instructions, .form-group, .filters, .button-group, .stats, .category-stats, .qr-card-buttons {
                display: none;
            }
            .qr-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .qr-card {
                page-break-inside: avoid;
                border: 2px solid #000;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚂 Railway Asset QR Code Generator</h1>
            <p>Generate QR codes for all railway assets across all categories</p>
        </div>

        <div class="content">
            <div class="instructions">
                <h3>📋 Instructions:</h3>
                <ol>
                    <li>Enter your WhatsApp complaint form URL below</li>
                    <li>Filter assets by category, station, or type (optional)</li>
                    <li>Click "Generate QR Codes" to create codes for all filtered assets</li>
                    <li>Print or download individual QR codes or download all as ZIP</li>
                </ol>
            </div>

            <div class="form-group">
                <label for="complaintUrl">WhatsApp Complaint Form URL:</label>
                <input type="url" id="complaintUrl" placeholder="https://your-domain.com/whatsapp-complaint-form.html" 
                       value="">
                <div class="url-preview">QR codes will link to: <span id="urlPreview">[Your URL]?assetcode=[ASSET_CODE]&category=[CATEGORY]</span></div>
            </div>

            <div class="filters">
                <div class="form-group">
                    <label for="categoryFilter">Filter by Category:</label>
                    <select id="categoryFilter">
                        <option value="">All Categories</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="stationFilter">Filter by Station:</label>
                    <select id="stationFilter">
                        <option value="">All Stations</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="typeFilter">Filter by Type:</label>
                    <select id="typeFilter">
                        <option value="">All Types</option>
                    </select>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="generateQRCodes()">🔄 Generate QR Codes</button>
                <button class="btn btn-secondary" onclick="window.print()">🖨️ Print All</button>
                <button class="btn btn-success" onclick="downloadAllQRCodes()">📥 Download All (ZIP)</button>
            </div>

            <div class="stats">
                <div class="stat-card">
                    <h3 id="totalAssets">43</h3>
                    <p>Total Assets</p>
                </div>
                <div class="stat-card">
                    <h3 id="filteredAssets">43</h3>
                    <p>Filtered Assets</p>
                </div>
                <div class="stat-card">
                    <h3 id="generatedQR">0</h3>
                    <p>QR Codes Generated</p>
                </div>
            </div>

            <div class="category-stats" id="categoryStats"></div>

            <div id="loadingMessage" class="loading" style="display:none;">
                Generating QR Codes...
            </div>

            <div id="qrContainer" class="qr-grid"></div>
        </div>
    </div>

    <script>
        // All assets data from all sheets - organized by category
        const allAssetsData = {"PAUT":[{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Old concourse of Chennai central","asset_code":"PnU-MAS-MAS-Toi-283","type":"PAUT (Revenue Model)","licensee_name":"M/s Meenakshi- Tiruvallur"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"New concourse of Chennai central","asset_code":"PnU-MAS-MAS-Toi-313","type":"PAUT (Revenue Model)","licensee_name":"M/s Lakshmi Agencies-Rangareddy"},{"station_code":"MASS","station":"Chennai Suburban","unit_location__platform":"PF-15 of MASS","asset_code":"PnU-MAS-MASS-Toi-211","type":"PAUT (ROMT Model)","licensee_name":"Sri. M. Harikrishnan"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Near Gate no 6 of chennai central","asset_code":"PnU-MAS-MAS-Toi-201","type":"PAUT (ROMT Model)","licensee_name":"M/s Saisharath Subbian & Co."},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Old concourse 1st floor","asset_code":"PnU-MAS-MAS-WRL-248","type":"ACWH","licensee_name":"M/s. Saisharath Subbian and Co"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"New concourse 1st floor","asset_code":"PnU-MAS-MAS-WRL-249","type":"ACWH","licensee_name":"M/s. Saisharath Subbian and Co"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Old concourse 2nd floor","asset_code":"PnU-MAS-MAS-WRL-250","type":"ACWH","licensee_name":"M/s. Saisharath Subbian and Co"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Old concourse 3rd floor","asset_code":"PnU-MAS-MAS-WRL-251","type":"ACWH","licensee_name":"M/s. Saisharath Subbian and Co"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"New concourse 2nd floor","asset_code":"PnU-MAS-MAS-WRL-252","type":"ACWH","licensee_name":"M/s. Saisharath Subbian and Co"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Near old concourse","asset_code":"PnU-MAS-MAS-ATM-117","type":"ATM","licensee_name":"M/s. State Bank of India"}],"PARKING":[{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":" ","asset_code":"PARKING-MAS-CAR-2024-67","type":"4 wheeler","licensee_name":"Narmadha Enterprises"},{"station_code":"MASS","station":"Chennai Central suburban","unit_location__platform":"Not Available","asset_code":"PARKING-MASS-2025-21","type":"2 wheeler","licensee_name":"Falcons Transport Services"}],"CATERING":[{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Concourse","asset_code":"GMU-04","type":"GMU","licensee_name":"NISHA PANDEY"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"6/7","asset_code":"GMU-05","type":"GMU","licensee_name":"GREEN STAR CATERS"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Concourse","asset_code":"GMU-10","type":"GMU","licensee_name":"AMBER FOODS"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"7/8","asset_code":"GMU-11","type":"GMU","licensee_name":"JANKI CATERING SERVICES"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Concourse","asset_code":"GMU-30","type":"GMU","licensee_name":"HOTEL SHAN"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"7/8","asset_code":"GMU-31","type":"GMU","licensee_name":"SANJEEVANI FOODS"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Concourse","asset_code":"GMU-32","type":"GMU","licensee_name":"FOODZONE"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Concourse","asset_code":"GMU-50","type":"GMU","licensee_name":"ARUN ICE CREAMS"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Concourse","asset_code":"GMU-60","type":"GMU","licensee_name":"CAFE COFFEE DAY"}],"NFR":[{"station_code":"MASS","station":"Chennai Central suburban","unit_location__platform":"Not Available","asset_code":"Not Available","type":"Not Available","licensee_name":"PODHIGAI ADS PRIVATE LIMITED-CHENNAI"},{"station_code":"MASS","station":"Chennai Central suburban","unit_location__platform":"Not Available","asset_code":"MC-37-OOH-MAS-1-23","type":"Not Available","licensee_name":"SUN AND CO-TIRUVALLUR"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Not Available","asset_code":"MC-37-MAS-RDN-23","type":"Not Available","licensee_name":"SRISHTI COMMUNICATIONS-BANGALROE"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Not Available","asset_code":"MC-37-MAS-RDN-24","type":"Not Available","licensee_name":"SRISHTI COMMUNICATIONS-BANGALROE"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Not Available","asset_code":"MC-37-MAS-RDN-25","type":"Not Available","licensee_name":"SRISHTI COMMUNICATIONS-BANGALROE"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Not Available","asset_code":"MC-37-MAS-RDN-26","type":"Not Available","licensee_name":"SRISHTI COMMUNICATIONS-BANGALROE"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Not Available","asset_code":"MC-37-MAS-RDN-27","type":"Not Available","licensee_name":"SRISHTI COMMUNICATIONS-BANGALROE"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Not Available","asset_code":"MC-37-MAS-RDN-28","type":"Not Available","licensee_name":"SRISHTI COMMUNICATIONS-BANGALROE"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Not Available","asset_code":"MC-37-MAS-RDN-29","type":"Not Available","licensee_name":"SRISHTI COMMUNICATIONS-BANGALROE"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Not Available","asset_code":"MC-37-MAS-RDN-30","type":"Not Available","licensee_name":"SRISHTI COMMUNICATIONS-BANGALROE"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Not Available","asset_code":"MC-37-MAS-RDN-31","type":"Not Available","licensee_name":"SRISHTI COMMUNICATIONS-BANGALROE"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Not Available","asset_code":"MC-37-MAS-RDN-32","type":"Not Available","licensee_name":"SRISHTI COMMUNICATIONS-BANGALROE"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Not Available","asset_code":"MC-37-MAS-RDN-33","type":"Not Available","licensee_name":"SRISHTI COMMUNICATIONS-BANGALROE"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Not Available","asset_code":"MC-37-MAS-RDN-34","type":"Not Available","licensee_name":"SRISHTI COMMUNICATIONS-BANGALROE"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Not Available","asset_code":"MC-37-MAS-RDN-35","type":"Not Available","licensee_name":"SRISHTI COMMUNICATIONS-BANGALROE"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Not Available","asset_code":"MC-37-MAS-RDN-36","type":"Not Available","licensee_name":"SRISHTI COMMUNICATIONS-BANGALROE"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Not Available","asset_code":"MC-37-MAS-RDN-37","type":"Not Available","licensee_name":"SRISHTI COMMUNICATIONS-BANGALROE"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Not Available","asset_code":"MC-37-MAS-RDN-38","type":"Not Available","licensee_name":"SRISHTI COMMUNICATIONS-BANGALROE"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Not Available","asset_code":"MC-37-MAS-RDN-39","type":"Not Available","licensee_name":"SRISHTI COMMUNICATIONS-BANGALROE"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Not Available","asset_code":"MC-37-MAS-RDN-40","type":"Not Available","licensee_name":"SRISHTI COMMUNICATIONS-BANGALROE"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Not Available","asset_code":"MC-37-MAS-RDN-41","type":"Not Available","licensee_name":"SRISHTI COMMUNICATIONS-BANGALROE"},{"station_code":"MAS","station":"Dr. M. G. R. Chennai Central","unit_location__platform":"Not Available","asset_code":"MC-37-MAS-RDN-42","type":"Not Available","licensee_name":"SRISHTI COMMUNICATIONS-BANGALROE"}]};

        // Flatten all assets into single array with category tag
        let allAssets = [];
        Object.keys(allAssetsData).forEach(category => {
            allAssetsData[category].forEach(asset => {
                allAssets.push({...asset, category: category});
            });
        });

        let filteredAssets = [...allAssets];

        // Initialize the page
        function init() {
            populateFilters();
            displayCategoryStats();
            updateStats();
            
            // Event listeners
            document.getElementById('complaintUrl').addEventListener('input', updateUrlPreview);
            document.getElementById('categoryFilter').addEventListener('change', applyFilters);
            document.getElementById('stationFilter').addEventListener('change', applyFilters);
            document.getElementById('typeFilter').addEventListener('change', applyFilters);
        }

        function populateFilters() {
            const categories = Object.keys(allAssetsData);
            const stations = [...new Set(allAssets.map(a => a.station))].sort();
            const types = [...new Set(allAssets.map(a => a.type).filter(t => t !== 'Not Available'))].sort();

            const categoryFilter = document.getElementById('categoryFilter');
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryFilter.appendChild(option);
            });

            const stationFilter = document.getElementById('stationFilter');
            stations.forEach(station => {
                const option = document.createElement('option');
                option.value = station;
                option.textContent = station;
                stationFilter.appendChild(option);
            });

            const typeFilter = document.getElementById('typeFilter');
            types.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                typeFilter.appendChild(option);
            });
        }

        function displayCategoryStats() {
            const statsContainer = document.getElementById('categoryStats');
            statsContainer.innerHTML = '';

            Object.keys(allAssetsData).forEach(category => {
                const count = allAssetsData[category].length;
                const card = document.createElement('div');
                card.className = 'category-card';
                card.innerHTML = `
                    <h4>${count}</h4>
                    <p>${category}</p>
                `;
                statsContainer.appendChild(card);
            });
        }

        function applyFilters() {
            const categoryFilter = document.getElementById('categoryFilter').value;
            const stationFilter = document.getElementById('stationFilter').value;
            const typeFilter = document.getElementById('typeFilter').value;

            filteredAssets = allAssets.filter(asset => {
                const matchesCategory = !categoryFilter || asset.category === categoryFilter;
                const matchesStation = !stationFilter || asset.station === stationFilter;
                const matchesType = !typeFilter || asset.type === typeFilter;
                return matchesCategory && matchesStation && matchesType;
            });

            updateStats();
        }

        function updateStats() {
            document.getElementById('filteredAssets').textContent = filteredAssets.length;
        }

        function updateUrlPreview() {
            const url = document.getElementById('complaintUrl').value || '[Your URL]';
            document.getElementById('urlPreview').textContent = `${url}?assetcode=[ASSET_CODE]&category=[CATEGORY]`;
        }

        function generateQRCodes() {
            const baseUrl = document.getElementById('complaintUrl').value;
            
            if (!baseUrl) {
                alert('Please enter a WhatsApp complaint form URL first!');
                return;
            }

            const qrContainer = document.getElementById('qrContainer');
            qrContainer.innerHTML = '';
            
            document.getElementById('loadingMessage').style.display = 'block';

            setTimeout(() => {
                filteredAssets.forEach((asset, index) => {
                    const qrCard = createQRCard(asset, baseUrl, index);
                    qrContainer.appendChild(qrCard);
                });

                document.getElementById('generatedQR').textContent = filteredAssets.length;
                document.getElementById('loadingMessage').style.display = 'none';
            }, 100);
        }

        function createQRCard(asset, baseUrl, index) {
            const card = document.createElement('div');
            card.className = 'qr-card';
            card.id = `qr-card-${index}`;

            const qrUrl = `${baseUrl}?assetcode=${encodeURIComponent(asset.asset_code)}&category=${encodeURIComponent(asset.category)}&station=${encodeURIComponent(asset.station_code)}`;

            card.innerHTML = `
                <span class="qr-category-badge">${asset.category}</span>
                
                <div class="qr-disclaimer">
                    <strong>⚠️ DISCLAIMER:</strong>
                    Scan this QR code to report issues or complaints related to this railway asset via WhatsApp. 
                    Ensure you have proper authorization before accessing facility maintenance systems.
                </div>
                
                <div class="qr-info">
                    <div class="qr-info-item">
                        <span class="qr-info-label">Station Code:</span>
                        <span class="qr-info-value">${asset.station_code}</span>
                    </div>
                    <div class="qr-info-item">
                        <span class="qr-info-label">Station Name:</span>
                        <span class="qr-info-value">${asset.station}</span>
                    </div>
                    <div class="qr-info-item">
                        <span class="qr-info-label">Stall ID (Asset Code):</span>
                        <span class="qr-info-value">${asset.asset_code}</span>
                    </div>
                </div>

                <div class="qr-code-container" id="qr-${index}"></div>

                <div class="asset-details">
                    <strong>Type:</strong> ${asset.type}<br>
                    <strong>Location:</strong> ${asset.unit_location__platform}<br>
                    <strong>Licensee:</strong> ${asset.licensee_name}
                </div>

                <div class="qr-card-buttons">
                    <button class="btn btn-primary btn-small" onclick="downloadQR(${index}, '${asset.asset_code}')">📥 Download</button>
                    <button class="btn btn-secondary btn-small" onclick="printQR(${index})">🖨️ Print</button>
                </div>
            `;

            setTimeout(() => {
                new QRCode(document.getElementById(`qr-${index}`), {
                    text: qrUrl,
                    width: 200,
                    height: 200,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });
            }, 50);

            return card;
        }

        function downloadQR(index, assetCode) {
            const qrElement = document.querySelector(`#qr-${index} img`);
            if (qrElement) {
                const link = document.createElement('a');
                link.download = `QR_${assetCode.replace(/[^a-zA-Z0-9]/g, '_')}.png`;
                link.href = qrElement.src;
                link.click();
            }
        }

        function printQR(index) {
            const card = document.getElementById(`qr-card-${index}`);
            const printWindow = window.open('', '', 'width=800,height=600');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Print QR Code</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        .qr-card { border: 2px solid #000; padding: 20px; max-width: 400px; margin: 0 auto; }
                        .qr-category-badge { background: #667eea; color: white; padding: 5px 15px; border-radius: 20px; font-size: 12px; font-weight: 600; }
                        .qr-disclaimer { background: #fff3cd; border: 2px solid #ffc107; padding: 15px; margin: 15px 0; }
                        .qr-info { background: #f5f5f5; padding: 12px; margin-bottom: 15px; }
                        .qr-info-item { display: flex; justify-content: space-between; padding: 6px 0; }
                        .qr-code-container { text-align: center; margin: 15px 0; }
                        .asset-details { font-size: 14px; margin-top: 15px; }
                    </style>
                </head>
                <body>${card.innerHTML}</body>
                </html>
            `);
            printWindow.document.close();
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 250);
        }

        async function downloadAllQRCodes() {
            if (filteredAssets.length === 0) {
                alert('Please generate QR codes first!');
                return;
            }

            const zip = new JSZip();

            for (let i = 0; i < filteredAssets.length; i++) {
                const qrElement = document.querySelector(`#qr-${i} img`);
                if (qrElement) {
                    const imgData = qrElement.src.split(',')[1];
                    const filename = `QR_${filteredAssets[i].category}_${filteredAssets[i].asset_code.replace(/[^a-zA-Z0-9]/g, '_')}.png`;
                    zip.file(filename, imgData, {base64: true});
                }
            }

            const content = await zip.generateAsync({type: 'blob'});
            saveAs(content, 'Railway_Asset_QR_Codes_All_Categories.zip');
        }

        // Initialize on page load
        window.onload = init;
    </script>
</body>
</html>